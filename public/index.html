<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agente IA de Agendamento v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        textarea::placeholder {
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 flex flex-col items-center justify-center min-h-screen p-4 text-white selection:bg-sky-500 selection:text-white">

    <div class="bg-slate-800 shadow-2xl rounded-xl p-6 md:p-10 w-full max-w-2xl">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-sky-400">Seu Assistente de Agendamento</h1>
            <p class="text-slate-400 mt-2 text-lg">Conectado à Inteligência Artificial e Base de Dados.</p>
        </div>

        <div class="space-y-6">
            <div>
                <label for="comando" class="block text-sm font-medium text-slate-300 mb-1">Seu comando:</label>
                <textarea
                    id="comando"
                    name="comando"
                    rows="4"
                    class="w-full p-4 bg-slate-700 border border-slate-600 rounded-lg shadow-sm focus:ring-2 focus:ring-sky-500 focus:border-sky-500 text-slate-100 placeholder-slate-500 resize-none transition-colors duration-150"
                    placeholder="Ex: Marcar reunião com Maria para amanhã às 10h..."
                ></textarea>
            </div>

            <button
                id="enviarComando"
                type="button"
                class="w-full bg-sky-500 hover:bg-sky-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 focus:ring-offset-slate-800 transition-all duration-150 ease-in-out transform hover:scale-105"
            >
                Enviar Comando
            </button>
        </div>

        <div id="areaResposta" class="mt-8 p-4 bg-slate-700 rounded-lg shadow hidden">
            <h3 class="text-lg font-semibold text-sky-400 mb-2">Resposta do Assistente:</h3>
            <p id="textoResposta" class="text-slate-300 whitespace-pre-line"></p>
        </div>
    </div>

    <script>
        // Teste para acionar deploy Vercel (comentário adicionado)
        const botaoEnviar = document.getElementById('enviarComando');
        const campoComando = document.getElementById('comando');
        const areaResposta = document.getElementById('areaResposta');
        const textoResposta = document.getElementById('textoResposta');

        // URL do seu endpoint no backend (já configurado para a Vercel)
        const BACKEND_URL = '/api/processar-comando'; 

        /**
         * Envia o comando para o backend e exibe a resposta.
         * @param {string} comandoTexto - O comando do utilizador.
         */
        async function processarComandoComBackend(comandoTexto) {
            areaResposta.classList.remove('hidden');
            textoResposta.textContent = 'A processar o seu pedido com o assistente inteligente...';

            try {
                // Faz a chamada para o endpoint da Serverless Function
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ comando: comandoTexto }), // Envia o comando no corpo do pedido
                });

                if (!response.ok) {
                    // Se a resposta do backend não for OK (ex: erro 500, 400)
                    const errorData = await response.json().catch(() => null); // Tenta obter dados do erro, se houver
                    const mensagemErro = errorData?.mensagem || `Erro do servidor: ${response.status}`;
                    console.error('Erro na resposta do backend:', response.status, errorData);
                    throw new Error(mensagemErro);
                }

                // Processa a resposta JSON do backend
                const data = await response.json();
                
                // Exibe a mensagem recebida do backend
                if (data.mensagem) {
                    textoResposta.textContent = data.mensagem;
                } else {
                    textoResposta.textContent = "Recebi uma resposta, mas não sei como mostrá-la.";
                    console.log("Dados recebidos do backend:", data);
                }

            } catch (error) {
                console.error('Erro ao enviar comando para o backend:', error);
                textoResposta.textContent = `Ocorreu um erro: ${error.message}. Verifique a consola para mais detalhes. Certifique-se de que o seu servidor backend (Serverless Function) foi implementado corretamente.`;
                // Mensagem específica se o URL padrão não for substituído (indicando que o backend não foi implementado)
                if (BACKEND_URL === '/api/processar-comando') {
                     textoResposta.textContent += "\nLembre-se: O backend para este exemplo precisa de ser implementado e feito deploy na Vercel.";
                }
            }
        }

        // Event listener para o botão de enviar comando
        botaoEnviar.addEventListener('click', () => {
            const comando = campoComando.value.trim();
            campoComando.value = ''; // Limpa o campo de comando após o envio

            if (comando) {
                processarComandoComBackend(comando);
            } else {
                // Se o campo estiver vazio
                areaResposta.classList.remove('hidden');
                textoResposta.textContent = 'Por favor, digite um comando antes de enviar.';
                // Oculta a mensagem de erro após alguns segundos
                setTimeout(() => {
                    if (!areaResposta.classList.contains('hidden') && textoResposta.textContent === 'Por favor, digite um comando antes de enviar.') {
                         areaResposta.classList.add('hidden');
                         textoResposta.textContent = ''; // Limpa o texto também
                    }
                }, 3000);
            }
        });

        // Permite enviar com Enter na textarea, prevenindo nova linha e clicando no botão
        campoComando.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault(); // Previne a criação de uma nova linha na textarea
                botaoEnviar.click();    // Simula o clique no botão de enviar
            }
        });
    </script>

</body>
</html>
